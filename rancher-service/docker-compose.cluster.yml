app:
  image: ${DOCKER_REPO}/cagliari:develop
  links:
    - redis-master:redis
  volumes:
    - /mnt/s3/record:/mnt/s3/record
    - /mnt/nfs/record:/mnt/nfs/record
    - /sdpfiles:/sdpfiles
  labels:
    io.rancher.container.pull_image: always
turn:
  image: ${DOCKER_REPO}/turn
  net: host
  labels:
    io.rancher.container.pull_image: always
    io.rancher.scheduler.global: true
kms:
  image: ${DOCKER_REPO}/kms
  volumes:
    - /mnt/s3/record:/mnt/s3/record
    - /mnt/nfs/record:/mnt/nfs/record
    - /sdpfiles:/sdpfiles
  net: host
  labels:
    io.rancher.container.pull_image: always
    io.rancher.scheduler.global: true
manarola:
  ports:
  - 9116:9116
  image: ${DOCKER_REPO}/manarola:develop
  links:
    - redis-master:redis
  labels:
    io.rancher.container.pull_image: always
# wowza:
#   image: "${DOCKER_REPO}/wowza"
#   net: host
#   volumes:
#     - /sdpfiles:/sdpfiles
#  labels:
#    io.rancher.container.pull_image: always
nginx:
  image: "${DOCKER_REPO}/nginx"
  ports:
   - "443:443"
   - "3000:3000"
   - "3030:3030"
  environment:
   - CAGLIARI_IP=172.31.24.162
   - CAGLIARI_PORT=443
   - MANAROLA_IP=172.31.24.162
   - MANAROLA_PORT=3000
#     - NGINX_STATUS_ALLOW_IP=metrics.dev.tutormeet.plus
   - NGINX_STATUS_ALLOW_IP=52.196.246.136
   - MATERIAL_IP=172.16.7.180
   - MATERIAL_PORT=3030
  labels:
    io.rancher.container.pull_image: always
    io.rancher.scheduler.global: true
redis-master:
  image: redis
  ports: 
    - 6379:6379
  volumes:
    - /redis_data:/data
redis-slave:
  image: redis
  command: redis-server --slaveof redis-master 6379
  links:
    - redis-master
  labels:
    io.rancher.scheduler.global: true
redis-sentinel:
  image: erichsu/redis-sentinel
  environment:
    - SENTINEL_DOWN_AFTER=5000
    - SENTINEL_FAILOVER=5000    
  links:
    - redis-master
    - redis-slave
  labels:
    io.rancher.scheduler.global: true